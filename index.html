<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üßæ ACA Steg 10 ‚Äì Daglig inventering</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --panel:#111827; /* gray-900 */
      --ink:#e5e7eb; /* gray-200 */
      --muted:#9ca3af; /* gray-400 */
      --accent:#22c55e; /* green-500 */
      --accent-2:#38bdf8; /* sky-400 */
      --danger:#ef4444; /* red-500 */
      --shadow:0 10px 25px rgba(0,0,0,.35);
      --radius:18px;
    }
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;
      background: radial-gradient(1200px 800px at 10% -10%, rgba(56,189,248,.10), transparent),
                  radial-gradient(900px 500px at 110% 10%, rgba(34,197,94,.10), transparent),
                  var(--bg);
      color:var(--ink);
    }
    .wrap{max-width:960px; margin:28px auto; padding:20px}
    header{display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .title{display:flex; gap:12px; align-items:center}
    .title h1{margin:0; font-size:clamp(20px,3vw,28px)}
    .subtitle{color:var(--muted); font-size:14px; max-width:680px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); margin-top:16px}
    fieldset{border:none; padding:0; margin:0}
    legend{font-weight:700; margin-bottom:10px}
    label{display:block; margin:10px 0 6px; color:var(--ink)}
    input[type="text"], input[type="date"], textarea{width:100%; background:#0b1220; border:1px solid rgba(255,255,255,.12); color:var(--ink); border-radius:12px; padding:12px 14px; outline:none}
    textarea{min-height:110px; resize:vertical}
    .row{display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:10px}
    .chips{display:grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap:8px; margin-top:8px}
    .chip{display:flex; align-items:center; gap:8px; background:#0b1220; border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:10px 12px}
    .hint{color:var(--muted); font-size:12.5px}
    .actions{position:sticky; bottom:12px; display:flex; gap:10px; flex-wrap:wrap; margin-top:20px}
    button{appearance:none; border:none; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer}
    .primary{background:linear-gradient(135deg, var(--accent), #16a34a); color:#06100a}
    .ghost{background:transparent; color:var(--ink); border:1px solid rgba(255,255,255,.15)}
    .danger{background:linear-gradient(135deg, var(--danger), #b91c1c); color:#170707}
    .ok{background:linear-gradient(135deg, var(--accent-2), #0284c7); color:#03121a}
    .grid-2{display:grid; grid-template-columns:1fr; gap:14px}
    @media (min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
    .footer{color:var(--muted); font-size:12px; margin-top:20px}

    /* Toast */
    .toast{
      position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
      background:rgba(17,24,39,.96); color:#e5e7eb;
      border:1px solid rgba(255,255,255,.16);
      border-radius:12px; padding:10px 14px;
      box-shadow:0 10px 25px rgba(0,0,0,.35);
      opacity:0; pointer-events:none;
      transition:opacity .4s ease, transform .4s ease;
      z-index:9999;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-6px)}
    .toast.success{border-color:#16a34a}
    .toast.info{border-color:#38bdf8}
    .toast.warn{border-color:#f59e0b}
    .toast.error{border-color:#ef4444}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div style="font-size:28px">üßæ</div>
        <div>
          <h1>ACA Steg 10 ‚Äì Daglig inventering</h1>
          <div class="subtitle">‚ÄùVi fortsatte v√•r sj√§lvrannsakan och erk√§nde genast n√§r vi hade fel.‚Äù (Steg 10, ACA Fellowship Text)</div>
        </div>
      </div>
    </header>

    <!-- Toast element -->
    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <form id="inv-form" class="card" autocomplete="on">
      <div class="row">
        <label>üìÖ Datum
          <input type="date" id="date" />
        </label>
        <label>üï∞Ô∏è Tid (valfritt)
          <input type="text" id="time" placeholder="Kv√§ll / 21:30 / etc." />
        </label>
      </div>

      <div class="card">
        <fieldset>
          <legend>1Ô∏è‚É£ Dagens h√§ndelser</legend>
          <div class="hint">Vad h√§nde idag som p√•verkade mig k√§nslom√§ssigt? (situationer, samtal, beslut ‚Äì positiva eller negativa)</div>
          <textarea id="events" placeholder="Ex: K√§nde mig avvisad n√§r ingen lyssnade p√• min id√© ..."></textarea>
        </fieldset>
      </div>

      <div class="card">
        <fieldset>
          <legend>2Ô∏è‚É£ K√§nslor</legend>
          <div class="hint">Kryssa i det som st√§mmer och/eller skriv egna.</div>
          <div class="chips">
            <label class="chip"><input type="checkbox" value="R√§dsla" class="feeling"> R√§dsla</label>
            <label class="chip"><input type="checkbox" value="Ilska" class="feeling"> Ilska</label>
            <label class="chip"><input type="checkbox" value="Skam" class="feeling"> Skam</label>
            <label class="chip"><input type="checkbox" value="Skuld" class="feeling"> Skuld</label>
            <label class="chip"><input type="checkbox" value="Sorg" class="feeling"> Sorg</label>
            <label class="chip"><input type="checkbox" value="Ensamhet" class="feeling"> Ensamhet</label>
            <label class="chip"><input type="checkbox" value="Stress" class="feeling"> Stress</label>
            <label class="chip"><input type="checkbox" value="L√§ttnad" class="feeling"> L√§ttnad</label>
            <label class="chip"><input type="checkbox" value="Gl√§dje" class="feeling"> Gl√§dje</label>
            <label class="chip"><input type="checkbox" value="Tacksamhet" class="feeling"> Tacksamhet</label>
          </div>
          <label style="margin-top:10px">‚úçÔ∏è Andra k√§nslor
            <input type="text" id="feeling-other" placeholder="Ex: Hoppl√∂shet, f√∂rvirring, hopp ..." />
          </label>
        </fieldset>
      </div>

      <div class="grid-2">
        <div class="card">
          <fieldset>
            <legend>3Ô∏è‚É£ Mitt inre barn</legend>
            <div class="hint">K√§nde jag mig liten, bortgl√∂md, r√§dd, o√§lskad?</div>
            <textarea id="inner-child" placeholder="Vad k√§nde det inre barnet? Vad beh√∂vde jag?"></textarea>
          </fieldset>
        </div>
        <div class="card">
          <fieldset>
            <legend>4Ô∏è‚É£ Min reaktion</legend>
            <div class="chips">
              <label class="chip"><input type="checkbox" value="Reaktiv" class="reaction"> Reaktiv</label>
              <label class="chip"><input type="checkbox" value="Kontrollerande" class="reaction"> Kontrollerande</label>
              <label class="chip"><input type="checkbox" value="Undvikande" class="reaction"> Undvikande</label>
              <label class="chip"><input type="checkbox" value="Aggressiv" class="reaction"> Aggressiv</label>
              <label class="chip"><input type="checkbox" value="Nedl√•tande" class="reaction"> Nedl√•tande</label>
              <label class="chip"><input type="checkbox" value="√Ñrlig" class="reaction"> √Ñrlig</label>
              <label class="chip"><input type="checkbox" value="S√•rbar" class="reaction"> S√•rbar</label>
              <label class="chip"><input type="checkbox" value="Lyssnande" class="reaction"> Lyssnande</label>
            </div>
            <label style="margin-top:10px">‚úçÔ∏è Beskriv
              <textarea id="reaction-notes" placeholder="Hur agerade jag? Vad blev effekten?"></textarea>
            </label>
          </fieldset>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <fieldset>
            <legend>5Ô∏è‚É£ Mina v√§rderingar</legend>
            <div class="hint">Gick jag emot mina v√§rderingar? Beh√∂ver jag erk√§nna/gottg√∂ra/be om hj√§lp?</div>
            <textarea id="values" placeholder="Om ja: vad beh√∂ver jag g√∂ra imorgon?"></textarea>
          </fieldset>
        </div>
        <div class="card">
          <fieldset>
            <legend>6Ô∏è‚É£ Framsteg</legend>
            <div class="hint">Vad gjorde jag bra idag ‚Äì √§ven om det var litet?</div>
            <textarea id="progress" placeholder="Sm√• steg r√§knas."></textarea>
          </fieldset>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <fieldset>
            <legend>7Ô∏è‚É£ Tacksamhet</legend>
            <textarea id="gratitude" placeholder="Minst 1‚Äì3 saker."></textarea>
          </fieldset>
        </div>
        <div class="card">
          <fieldset>
            <legend>8Ô∏è‚É£ √ñnskan eller b√∂n f√∂r imorgon</legend>
            <textarea id="prayer" placeholder="‚ÄùHj√§lp mig att sl√§ppa taget om‚Ä¶ / St√§rk mig i att‚Ä¶‚Äù"></textarea>
          </fieldset>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="primary" id="btn-copy">üìã Kopiera till urklipp</button>
        <button type="button" class="ok" id="btn-save">üíæ Spara i webbl√§saren</button>
        <button type="button" class="ghost" id="btn-load">üì• Ladda fr√•n webbl√§saren</button>
        <button type="button" class="danger" id="btn-clear">üóëÔ∏è Rensa allt</button>
      </div>

      <div class="footer">Tips: "Spara i webbl√§saren" sparar lokalt p√• denna enhet (localStorage). Inget skickas till n√•gon server.</div>
    </form>
  </div>

<script>
(function(){
  // --- Toast ---
  function showToast(msg, type='info'){
    let el = document.getElementById('toast');
    if(!el){
      el = document.createElement('div');
      el.id = 'toast';
      el.className = 'toast';
      el.setAttribute('role','status');
      el.setAttribute('aria-live','polite');
      document.body.appendChild(el);
    }
    el.textContent = msg;
    el.className = `toast show ${type}`;
    clearTimeout(showToast._t1); clearTimeout(showToast._t2);
    showToast._t1 = setTimeout(()=>{ el.classList.remove('show'); }, 2200);
    showToast._t2 = setTimeout(()=>{ el.className = 'toast'; }, 3200);
  }

  // --- Helpers ---
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const STORAGE_KEY = 'aca-step10-v2';

  // S√§tt dagens datum i datumf√§ltet om tomt
  const today = new Date().toISOString().slice(0,10);
  document.addEventListener('DOMContentLoaded', ()=>{
    if(!$('#date').value){ $('#date').value = today; }
  });

  function collectChecked(cls){
    return $$(cls).filter(el=>el.checked).map(el=>el.value);
  }

  function asText(){
    const date = $('#date').value || '';
    const time = $('#time').value || '';
    const events = $('#events').value || '';
    const feelings = collectChecked('.feeling');
    const feelingOther = $('#feeling-other').value || '';
    const innerChild = $('#inner-child').value || '';
    const reactions = collectChecked('.reaction');
    const reactionNotes = $('#reaction-notes').value || '';
    const values = $('#values').value || '';
    const progress = $('#progress').value || '';
    const gratitude = $('#gratitude').value || '';
    const prayer = $('#prayer').value || '';

    const lines = [
`üßæ ACA Steg 10 ‚Äì Daglig inventering`,
`üìÖ Datum: ${date}${time? '   üï∞Ô∏è Tid: ' + time : ''}`,
``,
`1Ô∏è‚É£ Dagens h√§ndelser`,
`${events}`,
``,
`2Ô∏è‚É£ K√§nslor`,
`${[...feelings, feelingOther].filter(Boolean).join(', ') || '(inga valda)'}`,
``,
`3Ô∏è‚É£ Mitt inre barn`,
`${innerChild}`,
``,
`4Ô∏è‚É£ Min reaktion`,
`${[...reactions].join(', ') || '(inga valda)'}`,
`${reactionNotes}`,
``,
`5Ô∏è‚É£ Mina v√§rderingar`,
`${values}`,
``,
`6Ô∏è‚É£ Framsteg`,
`${progress}`,
``,
`7Ô∏è‚É£ Tacksamhet`,
`${gratitude}`,
``,
`8Ô∏è‚É£ √ñnskan/b√∂n f√∂r imorgon`,
`${prayer}`
];
    return lines.join('\n');
  }

  function gatherPayload(){
    return {
      date: $('#date').value,
      time: $('#time').value,
      events: $('#events').value,
      feelings: collectChecked('.feeling'),
      feelingOther: $('#feeling-other').value,
      innerChild: $('#inner-child').value,
      reactions: collectChecked('.reaction'),
      reactionNotes: $('#reaction-notes').value,
      values: $('#values').value,
      progress: $('#progress').value,
      gratitude: $('#gratitude').value,
      prayer: $('#prayer').value
    };
  }

  function applyPayload(d){
    if(!d) return;
    $('#date').value = d.date || today;
    $('#time').value = d.time || '';
    $('#events').value = d.events || '';
    $$('.feeling').forEach(cb => cb.checked = (d.feelings||[]).includes(cb.value));
    $('#feeling-other').value = d.feelingOther || '';
    $('#inner-child').value = d.innerChild || '';
    $$('.reaction').forEach(cb => cb.checked = (d.reactions||[]).includes(cb.value));
    $('#reaction-notes').value = d.reactionNotes || '';
    $('#values').value = d.values || '';
    $('#progress').value = d.progress || '';
    $('#gratitude').value = d.gratitude || '';
    $('#prayer').value = d.prayer || '';
  }

  // --- Clipboard ---
  async function copyToClipboard(){
    const text = asText();
    try{
      await navigator.clipboard.writeText(text);
      showToast('Kopierat till urklipp ‚úî', 'success');
    }catch{
      const ta = document.createElement('textarea');
      ta.value = text; ta.style.position='fixed'; ta.style.opacity='0';
      document.body.appendChild(ta); ta.focus(); ta.select();
      try{ document.execCommand('copy'); showToast('Kopierat till urklipp ‚úî', 'success'); }
      catch{ showToast('Kunde inte kopiera automatiskt', 'error'); }
      finally{ document.body.removeChild(ta); }
    }
  }

  // --- Manuell spara/ladda ---
  function saveLocal(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(gatherPayload()));
    showToast('Sparat lokalt i webbl√§saren üíæ', 'info');
  }

  function loadLocal(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){ showToast('Ingen sparad data hittades', 'warn'); return; }
    try{
      applyPayload(JSON.parse(raw));
      showToast('Data laddad üì•', 'success');
    }catch{
      showToast('Kunde inte l√§sa sparad data', 'error');
    }
  }

  function clearAll(){
    if(!confirm('Rensa alla f√§lt?')) return;
    document.getElementById('inv-form').reset();
    $('#date').value = today;
    showToast('Formul√§ret rensat', 'info');
  }

  // --- Autosave (debounced) + Autoload ---
  let autosaveTimer = null;
  function scheduleAutosave(){
    clearTimeout(autosaveTimer);
    autosaveTimer = setTimeout(()=>{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(gatherPayload()));
      // Visa en diskret bekr√§ftelse ibland:
      showToast('Autosparat üíæ', 'info');
    }, 3000); // 3s efter senaste √§ndring
  }

  // Autoload n√§r sidan √∂ppnas
  (function autoloadOnStart(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      applyPayload(JSON.parse(raw));
      showToast('Auto-laddat fr√•n webbl√§saren', 'success');
    }catch{
      // tyst fel
    }
  })();

  // Lyssna p√• alla inmatningar f√∂r autosave
  ['input','change'].forEach(evt=>{
    document.addEventListener(evt, (e)=>{
      // Spara bara om det √§r inom v√•rt formul√§r
      if(e.target && e.target.closest && e.target.closest('#inv-form')){
        scheduleAutosave();
      }
    }, true);
  });

  // --- Event bindningar ---
  document.getElementById('btn-copy')?.addEventListener('click', copyToClipboard);
  document.getElementById('btn-save')?.addEventListener('click', saveLocal);
  document.getElementById('btn-load')?.addEventListener('click', loadLocal);
  document.getElementById('btn-clear')?.addEventListener('click', clearAll);

  // Om dina knappar heter annorlunda, uppdatera selektorerna ovan.
})();
</script>

</body>
</html>
